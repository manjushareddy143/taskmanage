trigger:
  - main

pool:
  vmImage: ubuntu-latest

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '18'
    displayName: 'Install Node.js'

  # Install dependencies based on lock file availability
  - script: |
      if [ -e yarn.lock ]; then
        echo "yarn.lock found. Installing dependencies with Yarn..."
        yarn install --frozen-lockfile
      elif [ -e package-lock.json ]; then
        echo "package-lock.json found. Installing dependencies with npm ci..."
        npm ci
      else
        echo "No lock file found. Installing dependencies with npm install..."
        npm install
      fi
    displayName: 'Install dependencies'

  # Install Playwright browsers
  - script: npx playwright install --with-deps
    displayName: 'Install Playwright browsers'

  # Run Playwright tests
  - script: npx playwright test
    displayName: 'Run Playwright tests'
    env:
      CI: 'true'
